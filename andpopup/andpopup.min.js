"use strict";function _instanceof(e,o){return null!=o&&"undefined"!=typeof Symbol&&o[Symbol.hasInstance]?!!o[Symbol.hasInstance](e):e instanceof o}function _classCallCheck(e,o){if(!_instanceof(e,o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,o){for(var n=0;n<o.length;n++){var a=o[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,o,n){return o&&_defineProperties(e.prototype,o),n&&_defineProperties(e,n),e}var Andpopup=function(){function t(e,o){var n=this;if(_classCallCheck(this,t),this.button=document.querySelectorAll(e),this.popup=document.querySelector("".concat(o.popupSelector)),this.wrapper=this.wrap("div","andpopup-wrapper"),this.close=this.create("div","andpopup__close"),this.overlay=this.createOverlay(),this.button&&(this.button.forEach(function(e){e.addEventListener("click",function(){n.showPopup()})}),this.wrapper.addEventListener("click",function(e){e.target.matches("".concat(o.popupSelector,", ").concat(o.popupSelector," *"))||n.hidePopup()}),this.close.addEventListener("click",function(){n.hidePopup()})),null!=o.sendForm){var a=document.querySelector("".concat(o.sendForm.formSelector));this.action(o),a.addEventListener("submit",function(){n.pending(),n.pendingLoad(o),n.sendForm(o)})}}return _createClass(t,[{key:"hidePopup",value:function(){this.wrapper.classList.remove("andpopup_show"),this.overlay.classList.remove("andpopup-overlay_show"),this.pendingRemove(),document.body.style.overflow=null}},{key:"showPopup",value:function(){this.wrapper.classList.add("andpopup_show"),this.overlay.classList.add("andpopup-overlay_show"),document.body.style.overflow="hidden"}},{key:"create",value:function(e,o){var n=document.createElement("".concat(e));return n.className="".concat(o),this.popup.prepend(n),n}},{key:"wrap",value:function(e,o){this.popup.insertAdjacentHTML("beforebegin","<".concat(e,' class="').concat(o,'">'));var n=this.popup.previousSibling;return n.append(this.popup),n}},{key:"createOverlay",value:function(){return null==document.querySelector(".andpopup-overlay")&&this.wrapper.insertAdjacentHTML("beforebegin",'<div class="andpopup-overlay">'),document.querySelector(".andpopup-overlay")}},{key:"pending",value:function(){var e=document.createElement("div");e.className="andpopup-load-overlay",this.popup.append(e)}},{key:"pendingLoad",value:function(e){var o=this.popup.querySelector(".andpopup-load-overlay"),n=document.createElement("div");if(n.className="andpopup-load-overlay__image",o.append(n),e){var a=e.sendForm;for(var t in a)"loadImage"===t&&(n.style.backgroundImage=a[t])}}},{key:"pendingLoadEnd",value:function(){this.popup.querySelector(".andpopup-load-overlay__image").remove()}},{key:"success",value:function(e){var o=this.popup.querySelector(".andpopup-load-overlay"),n=document.createElement("div");n.className="andpopup-load-overlay__success-image",o.append(n);var a=document.createElement("span");if(a.className="andpopup-load-overlay__success-text",a.innerText="Application sent",o.append(a),e){var t=e.sendForm;for(var r in t)"successImage"===r&&(n.style.backgroundImage=t[r]),"successText"===r&&(a.innerText=t[r])}}},{key:"error",value:function(e){var o=this.popup.querySelector(".andpopup-load-overlay"),n=document.createElement("div");n.className="andpopup-load-overlay__error-image",o.append(n);var a=document.createElement("span");if(a.className="andpopup-load-overlay__error-text",a.innerText="Error, try again",o.append(a),e){var t=e.sendForm;for(var r in t)"errorImage"===r&&(n.style.backgroundImage=t[r]),"errorText"===r&&(a.innerText=t[r])}}},{key:"pendingRemove",value:function(){var e=this.popup.querySelector(".andpopup-load-overlay");e&&setTimeout(function(){e.remove()},500)}},{key:"action",value:function(e){var o,n=e.sendForm;for(var a in n)"formSelector"===a&&null===(o=document.querySelector("".concat(n[a]))).getAttribute("action")&&o.setAttribute("action","javascript:void(0);")}},{key:"sendForm",value:function(o){var e,n,a=this,t=o.sendForm;for(var r in t)"filePath"===r&&(e=t[r]),"formSelector"===r&&(n=document.querySelector("".concat(t[r])));fetch(e,{method:"POST",body:new FormData(n)}).then(function(){a.pendingLoadEnd(),a.success(o)}).catch(function(e){console.log("Error to send form: ".concat(e)),a.pendingLoadEnd(),a.error(o)})}}]),t}();